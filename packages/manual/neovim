#!/usr/bin/env bash

# Install Neovim `VERSION` into `PREFIX`.

source "$DOTFILES/_helpers/general"

PREFIX="${PREFIX:-/usr/local/}"
VERSION="${VERSION:-latest}"

OS=$(uname -s)
ARCH=$(uname -m)

REPO="neovim/neovim"

case $OS in
Darwin) OS="macos" ;;
Linux) OS="linux" ;;
esac

case $ARCH in
*arm*) ARCH="arm64" ;;
*x86_64*) ARCH="x86_64" ;;
esac

NAME="nvim-$OS-$ARCH"
EXT="tar.gz"

TMP=$(mktemp -d)

cleanup() {
  info "Cleaning up"
  rm -rf "$TMP"
}

trap cleanup EXIT

EXTRACTED=$(download_from_github "$TMP" "$REPO" "$VERSION" "$NAME" "$EXT")

sudo mkdir -p "$PREFIX"/{bin,lib,share}
sudo cp -r "$EXTRACTED/$NAME"/{bin,lib,share} "$PREFIX"
